<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>vueを使ってaxiosを学ぶ</title>
</head>

<body>
    <div id="app">
        <p v-show="errorFlag">error occurred</p>
        <input v-model="name"><br>
        <button v-on:click="createNewUser">作成</button>
        <ul>
            <li v-for="user in users">{{ user.name }}
                <button v-on:click="deleteUser(user.id)">削除</button>
            </li>
        </ul>
    </div>

    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        Vue.createApp({
            el: '#app',
            data(){
                return {
                    users: [],
                    name: '',
                    errorFlag: false
                }
            },
            methods: {
                createNewUser: function(){
                    axios.post('https://jsonplaceholder.typicode.com/users',{
                        name: this.name
                    })
                    .then(response => this.users.unshift(response.data))
                    .catch(error => console.log(error))
                },
                deleteUser: function(id){
                    axios.delete('https://jsonplaceholder.typicode.com/users/' + id)
                        .then(response => console.log(response))
                        .catch(error => console.log(error))
                }
            },
            mounted(){
                axios.defaults.baseURL = 'https://jsonplaceholder.typicode.com';
                axios.interceptors.response.use((config) => {
                    // config.baseURL = 'https://test.com';
                    console.log(config)
                    return config;
                });
                axios.get('/users')
                    .then(response => this.users = response.data)
                    .catch(error => {
                        console.log(error)
                    })
            }
        }).mount('#app')
    </script>
</body>
</html>